<?php
// Database connection details
$host = 'localhost';
$username = 'root';
$password = '';
$database = 'rating_system';

// Create a connection
$conn = new mysqli($host, $username, $password, $database);

// Check connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

// Query to get all user ratings
$sql = "SELECT * FROM users ORDER BY created_at DESC";
$result = $conn->query($sql);

// Query to calculate total ratings and average rating
$stats_sql = "SELECT COUNT(*) AS total_ratings, AVG(rate) AS avg_rating FROM users";
$stats_result = $conn->query($stats_sql);

// Fetch statistics
$stats = $stats_result->fetch_assoc();
$total_ratings = $stats['total_ratings'];
$avg_rating = number_format($stats['avg_rating'], 2); // Format to 2 decimal places

echo "<h1>Submitted Ratings</h1>";

// Display statistics
echo "<p><strong>Total Ratings Submitted:</strong> $total_ratings</p>";
echo "<p><strong>Average Rating:</strong> $avg_rating &#9733;</p>";

if ($result->num_rows > 0) {
    // Loop through and display each user's submission
    while ($row = $result->fetch_assoc()) {
        echo "<p><strong>Name:</strong> " . $row['name'] . "</p>";
        echo "<p><strong>Email:</strong> " . $row['email'] . "</p>";
        echo "<p><strong>Rating:</strong> ";

        // Display stars based on the rating
        for ($i = 1; $i <= 5; $i++) {
            if ($i <= $row['rate']) {
                echo "&#9733; "; // Filled star
            } else {
                echo "&#9734; "; // Empty star
            }
        }

        echo "</p><hr>";
    }
} else {
    echo "<p>No ratings submitted yet.</p>";
}

// Close the connection
$conn->close();
?>
